---
phase: 02-projectile-ecs
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - crates/omega-bevy/src/simulation/projectiles.rs
  - crates/omega-bevy/src/simulation/mod.rs
autonomous: true

must_haves:
  truths:
    - "Projectile component stores 3D logical position and velocity"
    - "Projectile movement system applies gravity to Arc projectiles"
    - "Visual mapping from Z-height to Y-offset is implemented"
---

<objective>
Implement the core projectile ECS components and movement systems in Bevy. This handles the 'flight' of elements.

Output: Projectile component and movement system in omega-bevy.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Define Projectile component and register module</name>
  <files>
    crates/omega-bevy/src/simulation/projectiles.rs
    crates/omega-bevy/src/simulation/mod.rs
  </files>
  <action>
Create `crates/omega-bevy/src/simulation/projectiles.rs`:
- Define `Projectile` component:
  ```rust
  #[derive(Component)]
  pub struct Projectile {
      pub logical_pos: Vec3, // x, y are grid, z is height
      pub velocity: Vec3,
      pub mode: TrajectoryMode,
      pub props: ProjectilePhysicalProps,
      pub element_impact: Option<Cell>, // CA state to apply on hit
  }
  ```
- Register `projectiles` module in `mod.rs`.
  </action>
</task>

<task type="auto">
  <name>Task 2: Implement projectile movement and visual mapping</name>
  <files>
    crates/omega-bevy/src/simulation/systems.rs
  </files>
  <action>
Add `projectile_movement_system` to `systems.rs`:
- Use `Time<Fixed>` for consistent physics (64Hz).
- Apply `velocity` to `logical_pos`.
- If `mode` is `HighArc` or `FlatArc`, apply gravity (e.g., -9.8 or a game-tuned constant) to `velocity.z`.
- Update `Transform.translation`:
  - `translation.x` and `translation.y` based on `logical_pos.x/y` and tile size.
  - `translation.y += logical_pos.z * visual_scale` (Y-offset trick).
  - Set `translation.z` to a high value for visibility.
  </action>
</task>

</tasks>

<verification>
- `cargo check -p omega-bevy` passes
</verification>
