---
phase: 03-visual-fx-system
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified:
  - crates/omega-bevy/src/simulation/emitters.rs
  - crates/omega-bevy/src/simulation/mod.rs
autonomous: true

must_haves:
  truths:
    - "Projectiles leave dense 'smoke ribbon' trails"
    - "Explosions spawn epicenter-weighted particles with cascades"
    - "Settling debris becomes a static layer on the CA grid"
---

<objective>
Implement emitters for projectile trails and explosions, and handle particle 'settling' into the CA grid.

Output: Emitters and integration logic in omega-bevy.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Implement Trail and Explosion Emitters</name>
  <files>
    crates/omega-bevy/src/simulation/emitters.rs
    crates/omega-bevy/src/simulation/mod.rs
  </files>
  <action>
Create `crates/omega-bevy/src/simulation/emitters.rs`:
- Implement `trail_emitter_system`: spawn particles along `Projectile` path.
- Implement `explosion_emitter_system`: triggered by `DisplacementEvent`.
- Particles near epicenter live longer and start with higher intensity.
  </action>
</task>

<task type="auto">
  <name>Task 2: Handle particle settling</name>
  <files>
    crates/omega-bevy/src/simulation/systems.rs
  </files>
  <action>
Update `particle_lifecycle_system`:
- When a `Debris` particle hits the ground or dies, check if it should "settle".
- Inject `Ash` or `Rubble` into the `CaGrid`.
  </action>
</task>

</tasks>

<verification>
- `cargo check -p omega-bevy` passes
</verification>
